# Generated by Ansible
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
{% if firewall_config.open_udp is defined %}
:UDP - [0:0]
{% endif %}
{% if firewall_config.open_tcp is defined %}
:TCP - [0:0]
{% endif %}
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
{% for lo in firewall_config.loopback_adapters|default(['lo']) %}
-A INPUT -i {{ lo }} -j ACCEPT
{% endfor %}
-A INPUT -m conntrack --ctstate INVALID -j DROP
{% if not firewall_config.block_ping|default(false) %}
-A INPUT -p icmp -m icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT
{% endif %}
{% if firewall_config.open_udp is defined %}
-A INPUT -p udp -m conntrack --ctstate NEW -j UDP
{% else %}
-A INPUT -p udp -m conntrack --ctstate NEW -j DROP
{% endif %}
{% if firewall_config.open_tcp is defined %}
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j TCP
{% else %}
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j DROP
{% endif %}
-A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable
-A INPUT -p tcp -j REJECT --reject-with tcp-reset
-A INPUT -j REJECT --reject-with icmp-proto-unreachable
{% for port in firewall_config.open_udp|default([]) %}
{% if port.to_port is not defined and port.to_addr is not defined %}
-A UDP -p udp --dport {{ port.port }} -j ACCEPT
{% endif %}
{% endfor %}
{% for port in firewall_config.open_tcp|default([]) %}
{% if port.to_port is not defined and port.to_addr is not defined %}
-A TCP -p tcp --dport {{ port.port }} -j ACCEPT
{% endif %}
{% endfor %}
COMMIT
